---
title: "Goã§ã‚µã‚¯ãƒƒã¨ãƒªãƒƒãƒãªCLIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œã‚ã†ï¼"
emoji: "ğŸ˜›"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["go", "cli", "bubbletea"]
published: false
---

# ã¯ã˜ã‚ã«
ã“ã‚Œã¯ã‚µã‚¤ãƒãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®26å’å†…å®šè€…ãŒãŠå±Šã‘ã™ã‚‹ã€[CyberAgent 26th Fresh Engineer's Advent Calendar](https://qiita.com/advent-calendar/2024/ca-26th) 2024ã®2æ—¥ç›®ã®è¨˜äº‹ã§ã™ğŸ™Œ
ä»Šå›ã¯Goã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚‹ã€bubbleteaã®ç´¹ä»‹ã¨ã€å®Ÿéš›ã«ä½œã£ãŸCLIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç´¹ä»‹ã‚’ã—ã¾ã™ï¼

# bubbleteaã¨ã¯
https://github.com/charmbracelet/bubbletea
bubbleteaã¯ã€[Elmã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](https://guide.elm-lang.org/architecture/)ã«åŸºã¥ã„ã¦ä½œã‚‰ã‚ŒãŸGoã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚

## Elmã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã¯
å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨åŒã˜å›³ã§ã™ãŒã€Elmã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’ç°¡å˜ã«è¡¨ã™ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/6bbb889c5a44-20241201.png)
ã“ã“ã§ã¯ã€Elmã¯htmlã‚’å‡ºåŠ›ã—ã€ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã¯ãã‚Œã‚’è¡¨ç¤ºã—ã¾ã™ã€‚ãã—ã¦ã€ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã¯ç”»é¢ã‚’æ“ä½œã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®å…¥åŠ›ã‚’å—ã‘å–ã‚Šã€ãã‚Œã‚’`Msg`ã¨ã—ã¦Elmã«æ¸¡ã—ã¾ã™ã€‚
Elmã¯ãã®å…¥åŠ›ã‚’å‡¦ç†ã—ã€æ–°ã—ã„htmlã‚’å‡ºåŠ›ã—ã¾ã™ã€‚ã“ã®ã‚ˆã†ãªæµã‚Œã‚’ç¹°ã‚Šè¿”ã™ã“ã¨ã§ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå‹•ä½œã™ã‚‹ä»•çµ„ã¿ã«ãªã£ã¦ã„ã¾ã™ã€‚

Elmã®å†…éƒ¨ã§ã¯ã€ä»¥ä¸‹ã®3ã¤ã®è¦ç´ ãŒå‹•ä½œã—ã¦ã„ã¾ã™ã€‚
- **Model**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹
- **Update**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’å—ã‘å–ã‚Šã€çŠ¶æ…‹(Model)ã‚’æ›´æ–°ã™ã‚‹
- **View**: Modelã‚’å…ƒã«htmlã‚’å‡ºåŠ›ã™ã‚‹

MVC(Model-View-Controller)ã¨ä¼¼ã¦ã„ã¾ã™ãŒã€Elmã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯ä¾å­˜é–¢ä¿‚ãŒä¸€æ–¹å‘ã§ã‚ã‚‹ã“ã¨ãŒç‰¹å¾´ã§ã™ã€‚

## bubbleteaã®ä½¿ã„æ–¹
ã•ã¦ã€æ—©é€Ÿbubbleteaã‚’ä½¿ã£ã¦ã¿ã¾ã—ã‚‡ã†ï¼
è‡ªåˆ†ã¯CLIä¸Šã§ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç°¡å˜ã«æ›¸ããŸã‚ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½œã‚Šã¾ã—ãŸã€‚
ã‚‚ã¨ã‚‚ã¨ã¯[git-cz](https://github.com/streamich/git-cz)ã‚’ä½¿ã£ã¦ã„ãŸã®ã§ã™ãŒã€ã‚‚ã†å°‘ã—è‡ªåˆ†å¥½ã¿ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ãŸã‹ã£ãŸã®ã§ã€bubbleteaã‚’ä½¿ã£ã¦ä½œã‚Šã¾ã—ãŸã€‚

ä»¥ä¸‹ã®ã‚ˆã†ãªæ©Ÿèƒ½ãŒã‚ã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªCLIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ï¼
- ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã¤ã‘ã‚‹prefixã‚’é¸ã‚“ã§å…¥åŠ›ã‚’è¡Œã†
- prefixã«ä»˜ãçµµæ–‡å­—ã¯è‡ªåˆ†ã§è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã€ãƒ©ãƒ³ãƒ€ãƒ ã§è¡¨ç¤ºã•ã‚Œã‚‹
![](https://storage.googleapis.com/zenn-user-upload/aa932896bac6-20241201.gif)

ãƒ©ãƒ³ãƒ€ãƒ ã§è¡¨ç¤ºã™ã‚‹çµµæ–‡å­—ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šã—ã¦ã„ã¾ã™ï¼ã“ã‚Œã«ã‚ˆã‚Šã€ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ä»˜ãçµµæ–‡å­—ã‚’æ¯å›å¤‰ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ğŸ™Œ
```json
{
  "feat": ["âœ¨", "ğŸš€", "ğŸ‰"],
  "fix": ["ğŸ›", "ğŸ”§", "ğŸš‘ï¸"],
  "docs": ["ğŸ“š", "âœï¸", "ğŸ“"],
  "style": ["ğŸ¨", "ğŸ’„", "ğŸ¯"],
  "refactor": ["â™»ï¸", "ğŸ› ï¸", "ğŸ”„"],
  "perf": ["âš¡", "ğŸ”¥", "ğŸ’¨"],
  "test": ["âœ…", "ğŸ§ª", "ğŸ“Š"],
  "chore": ["ğŸ§¹", "ğŸ“¦", "ğŸ”’"]
}
```

å…¨ä½“ã®ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ãƒªãƒã‚¸ãƒˆãƒªã«ã‚ã‚‹ã®ã§ã€ã‚ˆã‹ã£ãŸã‚‰è¦‹ã¦ã¿ã¦ãã ã•ã„ï¼

https://github.com/mshr0969/simple-git-cz

### Model
Elmã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«åŸºã¥ã„ã¦ã€å„è¦ç´ ã‚’å®šç¾©ã—ã¾ã™ï¼
ã¾ãšã¯Modelã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹ã‚’ç®¡ç†ã—ã¾ã™ã€‚
```go
type model struct {
    choices      []string        // CLIã«è¡¨ç¤ºã™ã‚‹ã‚¢ã‚¤ãƒ†ãƒ 
    cursor       int             // ã‚«ãƒ¼ã‚½ãƒ«ã®ä½ç½®
    selected     string          // é¸æŠã•ã‚ŒãŸã‚¢ã‚¤ãƒ†ãƒ 
    message      textinput.Model // ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ç”¨ã®ãƒ¢ãƒ‡ãƒ«
    quitting     bool            // çµ‚äº†ãƒ•ãƒ©ã‚°
    currentState state           // çŠ¶æ…‹
}
```

### ãƒ¢ãƒ‡ãƒ«ã®åˆæœŸåŒ–
æ¬¡ã«ã€åˆæœŸåŒ–é–¢æ•°ã§ã€Modelã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚
ãƒ†ã‚­ã‚¹ãƒˆã®å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ã‚‹ãŸã‚ã«ã€`textinput`ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚
```go
func initialModel() model {
	ti := textinput.New()
	ti.Placeholder = "Enter your commit message"
	ti.Focus()
	ti.CharLimit = 156
	ti.Width = 40

	return model{
		choices: []string{
			"feat: A new feature",
			"fix: A bug fix",
			"docs: Documentation only changes",
			"style: Changes that do not affect the code meaning (white-space, formatting, etc.)",
			"refactor: A code change that neither fixes a bug nor adds a feature",
			"perf: A code change that improves performance",
			"test: Adding missing tests or correcting existing tests",
			"chore: Other changes that don't modify src or test files",
		},
		cursor:       0,
		message:      ti,
		currentState: choosePrefix,
	}
}
```
æ¬¡ã«ã€Modelã®ãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚ã‚‹`Init`é–¢æ•°ã‚’å®šç¾©ã—ã€åˆæœŸI/Oã‚’è¨­å®šã—ã¾ã™ã€‚
ã“ã“ã§ã¯ã€ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã®ã‚«ãƒ¼ã‚½ãƒ«ã‚’ç‚¹æ»…ã•ã›ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¦ã„ã¾ã™ã€‚
```go
func (m model) Init() tea.Cmd {
	return textinput.Blink
}
```

### Update
æ¬¡ã«ã€Updateé–¢æ•°ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ã¾ã™ã€‚ãã®å…¥åŠ›ã«å¿œã˜ã¦ã€Modelã‚’æ›´æ–°ã—ã¾ã™ã€‚
ã¡ã‚‡ã£ã¨é•·ã„ã§ã™ãŒã€ã“ã“ã«ä¸»ãªãƒ­ã‚¸ãƒƒã‚¯ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚
ã‚„ã£ã¦ã„ã‚‹ã“ã¨ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼
- `tea.KeyMsg`ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®å…¥åŠ›ã‚’å—ã‘å–ã‚‹
- `curentState`ã§çŠ¶æ…‹ã‚’ç®¡ç†ã—ã€ãã‚Œã«å¿œã˜ã¦å‡¦ç†ã‚’åˆ†å²ã•ã›ã‚‹
  - åˆæœŸå€¤ã§ã¯prefixã‚’é¸æŠã™ã‚‹çŠ¶æ…‹
  - prefixã‚’é¸æŠã—ãŸã‚‰ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã™ã‚‹çŠ¶æ…‹ã«é·ç§»ã™ã‚‹
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã€enterã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸã‚‰ã€prefixã‚’ã¤ã‘ã¦ã‚³ãƒŸãƒƒãƒˆã™ã‚‹

```go
func (m model) Update(msg tea.Msg) (tea.Model, tea.Cmd) {
	var cmd tea.Cmd
	switch msg := msg.(type) {
	case tea.KeyMsg:
		switch m.currentState {
		case choosePrefix:
			switch msg.String() {
			case "ctrl+c", "q":
				m.quitting = true
				return m, tea.Quit
			case "up", "k":
				if m.cursor > 0 {
					m.cursor--
				}
			case "down", "j":
				if m.cursor < len(m.choices)-1 {
					m.cursor++
				}
			case "enter":
				prefix := strings.SplitN(m.choices[m.cursor], ":", 2)[0]
				m.selected = prefix + ": " + randomEmoji(prefix) + " "
				m.currentState = enterMessage
			}

		case enterMessage:
			switch msg.String() {
			case "ctrl+c":
				m.quitting = true
				return m, tea.Quit
			case "enter":
				m.commit(m.selected + m.message.Value())
				m.currentState = commitDone
				return m, tea.Quit
			}

			m.message, cmd = m.message.Update(msg)
		}
	}

	return m, cmd
}
```

### View
CLIã«è¡¨ç¤ºã™ã‚‹å†…å®¹ã‚’ã€Viewé–¢æ•°ã§å®šç¾©ã—ã¾ã™ï¼
ç¾åœ¨ã®çŠ¶æ…‹ã«å¿œã˜ã¦ã€UIã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¾ã™ã€‚
```go
func (m model) View() string {
	if m.quitting {
		return "Exiting...\n"
	}

	switch m.currentState {
	case choosePrefix:
		s := "Choose a commit message prefix:\n\n"
		for i, choice := range m.choices {
			cursor := " "
			line := itemStyle.Render(choice)

			if m.cursor == i {
				cursor = ">"
				line = selectedItemStyle.Render(choice)
			}

			s += fmt.Sprintf("%s %s\n", cursor, line)
		}
		return s
	case enterMessage:
		return fmt.Sprintf("Enter your commit message (starting with %s):\n\n%s%s", m.selected, m.selected, m.message.View())
	case commitDone:
		return "Commit complete!\n"
	}
	return ""
}
```

### mainé–¢æ•°
æœ€å¾Œã«ã€mainé–¢æ•°ã§bubbleteaã‚’å®Ÿè¡Œã—ã¾ã™ï¼
çµµæ–‡å­—ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ã€Modelã‚’åˆæœŸåŒ–ã—ã€bubbleteaã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
```go
func main() {
	emojiFile := os.Getenv("EMOJI_FILE")
	if emojiFile == "" {
		log.Fatalf("EMOJI_FILE is not set")
	}
	loadEmojis(emojiFile)

	m := initialModel()
	p := tea.NewProgram(m)

	if err := p.Start(); err != nil {
		fmt.Fprintf(os.Stderr, "Alas, there's been an error: %v", err)
		os.Exit(1)
	}
}
```

# ã¾ã¨ã‚
bubbleteaã‚’ä½¿ãˆã°ç°¡å˜ã«ãƒªãƒƒãƒãªCLIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼
ä»Šå›ã¯ãã®ä¸­ã§ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªã‚»ãƒ¬ã‚¯ãƒˆã‚’ä½¿ã„ã¾ã—ãŸãŒã€ä»–ã«ã‚‚æ§˜ã€…ãªãŠã—ã‚ƒã‚Œãªæ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚
ä¾‹ã‚‚å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ãœã²ãƒã‚§ãƒƒã‚¯ã—ã¦ã¿ã¦ãã ã•ã„ï¼ï¼
https://github.com/charmbracelet/bubbletea/tree/master/examples
